---
// layouts/Layout.astro - Enhanced SEO Version with improvements
import '../styles/main.scss';

export interface Props {
  title?: string;
  description?: string;
  image?: string;
  keywords?: string;
  type?: 'website' | 'article' | 'product';
  price?: string;
  currency?: string;
  availability?: 'InStock' | 'OutOfStock' | 'PreOrder';
  category?: string;
  publishedDate?: string;
  modifiedDate?: string;
  author?: string;
  noindex?: boolean;
  alternateLanguages?: Array<{lang: string, url: string}>;
}

const {
  title = "Success Odyssey - Transform Your Life with Proven Strategies",
  description = "Discover mental models, stoicism, and success philosophy. Transform your life with proven strategies and timeless wisdom for personal development.",
  image = "/assets/banner.jpg",
  keywords = "success, philosophy, stoicism, mental models, personal development, mindfulness, self improvement",
  type = 'website',
  price,
  currency = 'USD',
  availability = 'InStock',
  category,
  publishedDate,
  modifiedDate,
  author = "Success Odyssey",
  noindex = false,
  alternateLanguages = []
} = Astro.props;

// Canonical URL
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const imageURL = new URL(image, Astro.site).toString();
const currentDate = new Date().toISOString();

// Breadcrumb structured data
const pathSegments = Astro.url.pathname.split('/').filter(segment => segment);
const breadcrumbList = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": Astro.site
    },
    ...pathSegments.map((segment, index) => ({
      "@type": "ListItem",
      "position": index + 2,
      "name": segment.charAt(0).toUpperCase() + segment.slice(1).replace('-', ' '),
      "item": new URL(pathSegments.slice(0, index + 1).join('/'), Astro.site).toString()
    }))
  ]
};

// Main structured data
const mainSchema = {
  "@context": "https://schema.org",
  "@type": type === 'product' ? 'Product' : (type === 'article' ? 'BlogPosting' : 'WebSite'),
  "name": title,
  "description": description,
  "url": canonicalURL.toString(),
  "image": imageURL,
  "author": {
    "@type": "Organization",
    "name": author,
    "url": Astro.site
  },
  "publisher": {
    "@type": "Organization",
    "name": "Success Odyssey",
    "url": Astro.site,
    "logo": {
      "@type": "ImageObject",
      "url": new URL('/favicon.svg', Astro.site).toString()
    }
  }
};

// Add product-specific data
if (type === 'product' && price) {
  mainSchema.offers = {
    "@type": "Offer",
    "price": price,
    "priceCurrency": currency,
    "availability": `https://schema.org/${availability}`,
    "url": canonicalURL.toString()
  };

  if (category) {
    mainSchema.category = category;
  }
}

// Add article-specific data
if (type === 'article') {
  if (publishedDate) mainSchema.datePublished = publishedDate;
  if (modifiedDate) mainSchema.dateModified = modifiedDate;
  else mainSchema.dateModified = currentDate;

  mainSchema.mainEntityOfPage = {
    "@type": "WebPage",
    "@id": canonicalURL.toString()
  };
}
---

<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Basic SEO -->
<title>{title}</title>
<meta name="description" content={description} />
<meta name="keywords" content={keywords} />
<meta name="author" content={author} />

<!-- Robots & Indexing -->
{noindex && <meta name="robots" content="noindex, nofollow" />}
{!noindex && <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />}

<!-- Canonical -->
<link rel="canonical" href={canonicalURL.toString()} />

<!-- Alternate Languages -->
{alternateLanguages.map(({lang, url}) => (
<link rel="alternate" hreflang={lang} href={url} />
))}

<!-- Open Graph -->
<meta property="og:type" content={type} />
<meta property="og:site_name" content="Success Odyssey" />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:url" content={canonicalURL.toString()} />
<meta property="og:image" content={imageURL} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:alt" content={title} />
<meta property="og:locale" content="en_US" />

<!-- Product-specific OG tags -->
{type === 'product' && price && (
<>
<meta property="product:price:amount" content={price} />
<meta property="product:price:currency" content={currency} />
<meta property="product:availability" content={availability.toLowerCase()} />
</>
)}

<!-- Article-specific OG tags -->
{type === 'article' && publishedDate && (
<>
<meta property="article:published_time" content={publishedDate} />
<meta property="article:modified_time" content={modifiedDate || currentDate} />
<meta property="article:author" content={author} />
</>
)}

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@successodyssey" />
<meta name="twitter:creator" content="@successodyssey" />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={imageURL} />
<meta name="twitter:image:alt" content={title} />

<!-- Favicon -->
<link rel="icon" href="/favicon.svg" type="image/svg+xml" />
<link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png" />
<link rel="manifest" href="/site.webmanifest" />

<!-- DNS Prefetch & Preconnect -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link rel="dns-prefetch" href="//www.google-analytics.com" />
<link rel="dns-prefetch" href="//googletagmanager.com" />

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

<!-- Theme -->
<meta name="theme-color" content="#2563eb" />
<meta name="msapplication-TileColor" content="#2563eb" />
<meta name="color-scheme" content="light dark" />

<!-- Performance & Security -->
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="format-detection" content="telephone=no" />

<!-- Structured Data -->
<script type="application/ld+json" set:html={JSON.stringify(mainSchema)} />
<script type="application/ld+json" set:html={JSON.stringify(breadcrumbList)} />

<!-- Organization Structured Data -->
<script type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Success Odyssey",
  "url": Astro.site,
  "logo": new URL('/favicon.svg', Astro.site).toString(),
  "sameAs": [
    "https://twitter.com/successodyssey",
    "https://facebook.com/successodyssey",
    "https://linkedin.com/company/successodyssey"
  ],
  "contactPoint": {
    "@type": "ContactPoint",
    "contactType": "customer service",
    "availableLanguage": "English"
  }
})} />

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'GA_MEASUREMENT_ID');
</script>
</head>
<body>
<!-- Skip to main content for accessibility -->
<a href="#main-content" class="skip-to-main">Skip to main content</a>

<!-- Navigation -->
<header class="header">
<nav class="nav" itemscope itemtype="https://schema.org/SiteNavigationElement">
<div class="nav-container">
<a href="/" class="logo" itemprop="url">
<svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z" fill="currentColor"/>
</svg>
<span itemprop="name">Success Odyssey</span>
</a>
<ul class="nav-links">
<li><a href="/" itemprop="url">Home</a></li>
<li><a href="/blog" itemprop="url">Blog</a></li>
<li><a href="/products" itemprop="url">Products</a></li>
<li><a href="/about" itemprop="url">About</a></li>
</ul>
</div>
</nav>
</header>

<!-- Main Content -->
<main id="main-content" class="main">
<slot />
</main>

<!-- Footer -->
<footer class="footer" itemscope itemtype="https://schema.org/WPFooter">
<div class="footer-container">
<div class="footer-content">
<div class="footer-section">
<h3>Success Odyssey</h3>
<p>Transform your life with proven strategies and timeless wisdom.</p>
</div>
<div class="footer-section">
<h4>Quick Links</h4>
<ul>
<li><a href="/">Home</a></li>
<li><a href="/blog">Blog</a></li>
<li><a href="/products">Products</a></li>
<li><a href="/about">About</a></li>
<li><a href="/privacy">Privacy Policy</a></li>
<li><a href="/terms">Terms of Service</a></li>
</ul>
</div>
<div class="footer-section">
<h4>Topics</h4>
<ul>
<li><a href="/blog/mental-models">Mental Models</a></li>
<li><a href="/blog/stoicism">Stoicism</a></li>
<li><a href="/blog/success-philosophy">Success Philosophy</a></li>
</ul>
</div>
</div>
<div class="footer-bottom">
<p>&copy; 2025 Success Odyssey. All rights reserved.</p>
</div>
</div>
</footer>
</body>
</html>

<style lang="scss">
.skip-to-main {
  position: absolute;
  top: -40px;
  left: 6px;
  background: var(--primary-color);
  color: white;
  padding: 8px;
  border-radius: 0 0 4px 4px;
  text-decoration: none;
  z-index: 1000;

  &:focus {
    top: 0;
  }
}

// Responsive navigation for mobile
@media (max-width: 768px) {
  .nav {
    &-container {
      flex-wrap: wrap;
    }

    &-links {
      width: 100%;
      justify-content: center;
      margin-top: 1rem;
      gap: 1rem;

      a {
        font-size: 0.9rem;
      }
    }
  }
}
</style>